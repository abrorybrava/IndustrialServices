@{
    ViewData["Title"] = "Article Details";
    var httpcontext = ViewContext.HttpContext;
    string role = httpcontext.Session.GetString("Role");
    if (string.IsNullOrEmpty(role))
    {
        // Session is expired or role is not set, redirect to login layout
        Layout = null;

        <script>
            window.location.href = '@Url.Action("Index", "Login")';
        </script>

        return;
    }
    if (role == "Admin")
    {
        Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    }
    if (role == "Contributor")
    {
        Layout = "~/Views/Shared/_LayoutContributor.cshtml";
    }

}

<div class="pagetitle">
    <h1>- Article Details -</h1>
</div>
<br />

<section class="section">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Article Detail View</h5>
                    <hr />
                    <br />

                    <!-- Form for editing article data -->
                    <div class="row mb-3">
                        <input type="text" class="form-control" name="id_artikel" id="id_artikel" value="@ViewBag.Id" hidden>
                    </div>
                    <div class="row mb-3">
                        <label for="tanggal_rilis" class="col-sm-2 col-form-label">Date of Release</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="tanggal_rilis" id="tanggal_rilis" disabled>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="judul_artikel" class="col-sm-2 col-form-label">Article Title</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="judul_artikel" id="judul_artikel" disabled>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="nama_pengelola" class="col-sm-2 col-form-label">Added by</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="nama_pengelola" id="nama_pengelola" disabled>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="sampul_artikel" class="col-sm-2 col-form-label">Article Cover</label>
                        <div class="col-sm-10">
                            <img src="" id="preview_image" alt="Article Cover" width="70" height="70">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="isi_artikel" class="col-sm-2 col-form-label">Article Content</label>
                        <div class="col-sm-10">
                            @Html.Raw("<p name='isi_artikel' id='isi_artikel'></p>")


                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-10">
                            <!-- Use hidden input for status -->
                            <input type="hidden" class="form-control" id="status" name="status" value="1" />
                        </div>
                    </div>
                    <br />
                    <br />

                    <a class="btn btn-secondary" asp-action="Index" asp-controller="Artikel">Back</a>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var today = new Date();

        // Mendapatkan tanggal dalam format yang dapat dimasukkan ke dalam database (yyyy-MM-dd)
        var formattedDate = today.toISOString().split('T')[0]; // 'en-CA' adalah kode untuk format 'yyyy-MM-dd'

        // Set nilai default pada input tanggal dengan id "tanggal_rilis"
        document.getElementById('tanggal_rilis').value = formattedDate;

        // Load article data after setting the default date
        loadArticleData();
    });

    function loadArticleData() {
        var id_artikel = document.getElementById("id_artikel");
        var nama_pengelola = document.getElementById("nama_pengelola");
        var judul_artikel = document.getElementById("judul_artikel");
        var sampul_artikel = document.getElementById("sampul_artikel");
        var isi_artikel = document.getElementById("isi_artikel");
        var status = document.getElementById("status");

        var hostname = "https://localhost:7033/";
        var url = hostname + "GetArtikel?id=" + id_artikel.value;
        var method = "GET";

        $.ajax({
            url: url,
            method: method,
            contentType: "application/json",
            success: function (data) {
                var article = data.data;

                // Fetch pengelola data based on id_pengelola
                $.ajax({
                    url: hostname + "GetPengelolaWebById?id=" + article.id_pengelola,
                    method: "GET",
                    contentType: "application/json",
                    success: function (pengelola) {
                        console.log(pengelola)
                        var nama = pengelola.data.nama_pengelola;
                        nama_pengelola.value = nama;
                        judul_artikel.value = article.judul_artikel;
                        isi_artikel.innerHTML = article.isi_artikel;
                        status.value = article.status;

                        // Tampilkan pratinjau gambar sampul artikel jika ada
                        if (article.sampul_artikel) {
                            var imagePath = "/assets/img/" + article.sampul_artikel;
                            $("#preview_image").attr("src", imagePath);
                        }
                    }
                });
            }
        });
    }


</script>
